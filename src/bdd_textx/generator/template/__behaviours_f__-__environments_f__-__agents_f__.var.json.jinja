{
    "@context": [
        "{{ secoro_mm }}/acceptance-criteria/bdd/bdd.json",
        "{{ secoro_mm }}/acceptance-criteria/bdd/task.json",
        {
            "@base": "{{ namespaces.bdd.uri }}",
            "{{ namespaces.tmpl.name }}": "{{ namespaces.tmpl.uri }}",
            "{{ namespaces.agents.name }}": "{{ namespaces.agents.uri }}",
            "{{ namespaces.environments.name }}": "{{ namespaces.environments.uri }}",
            "{{ namespaces.scene_env.name }}": "{{ namespaces.scene_env.uri }}",
            "{{ namespaces.scene.name }}": "{{ namespaces.scene.uri }}"
        }
    ],
    "@graph": [
        {% for story in stories %}
        {% for scenario in story.scenarios %}
        {% for variation in scenario.variations %}
        {
            "@id": "{{ variation.variable.name }}-{{ scenario.name }}-{{ story.name }}", "@type": "bdd:TaskVariation",
            "of-task": "{{ namespaces.tmpl.name }}:{{ variation.task.name }}",
            "of-variable": "{{ namespaces.tmpl.name }}:{{ variation.variable.name }}",
            {% if variation.objects|length > 0  %}
            "can-be": [ {% for object in variation.objects %}"{{ namespaces.environments.name }}:obj-{{ object.name }}"{% if not loop.last %}, {% endif %}{% endfor %} ]
            {% elif variation.workspaces|length > 0 %}
            "can-be": [ {% for workspace in variation.workspaces %}"{{ namespaces.environments.name }}:ws-{{ workspace.name }}"{% if not loop.last %}, {% endif %}{% endfor %} ]
            {% else %}
            "can-be": [ {% for agent in variation.agents %}"{{ namespaces.agents.name }}:{{ agent.name }}"{% if not loop.last %}, {% endif %}{% endfor %} ]
            {% endif %}
        },
        {% endfor %}
        {
            "@id": "{{ scenario.name }}", "@type": "bdd:ScenarioVariant",
            "of-template": "{{ namespaces.tmpl.name }}:{{ scenario.template.name }}",
            "has-scene": [
                "{{ namespaces.scene_env.name }}:{{ scenario.scene.name }}-{{ namespaces.environments.name }}-objects",
                "{{ namespaces.scene_env.name }}:{{ scenario.scene.name }}-{{ namespaces.environments.name }}-workspaces",
                {% for agent in scenario.scene.agents %}
                "{{ namespaces.scene.name }}:{{ scenario.scene.name }}-{{ namespaces.agents.name }}-{{ agent.name }}"{% if not loop.last %},{% endif +%}
                {% endfor %}
            ],
            "has-variation": [
                {%+ for variation in scenario.variations %}"{{ variation.variable.name }}-{{ scenario.name }}-{{ story.name }}"{% if not loop.last %}, {% endif %}{% endfor +%}
            ]
        },
        {% endfor %}
        {
            "@id": "{{ story.name }}", "@type": "bdd:UserStory",
            "has-criteria": [
                {%+ for scenario in story.scenarios %}"{{ scenario.name }}"{% if not loop.last %}, {% endif %}{% endfor +%}
            ]
        }{% if not loop.last %},{% endif +%}
        {% endfor %}
    ]
}